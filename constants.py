from datetime import datetime

# –ö–æ–Ω—Å—Ç–∞–Ω—Ç–∏ –¥–ª—è –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å
MESSAGES = {
    'start': '–ü—Ä–∏–≤—ñ—Ç! –Ø –±–æ—Ç –¥–ª—è —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ç–æ—Ä–∞–º–∏.',
    'access_request_sent': '–í–∞—à –∑–∞–ø–∏—Ç –Ω–∞ –¥–æ—Å—Ç—É–ø –≤—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–æ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞–º. –û—á—ñ–∫—É–π—Ç–µ —ó—Ö —Ä—ñ—à–µ–Ω–Ω—è.',
    'select_router': '–í–∏–±–µ—Ä—ñ—Ç—å –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ç–æ—Ä:',
    'select_script': '–í–∏–±–µ—Ä—ñ—Ç—å —Å–∫—Ä–∏–ø—Ç –¥–ª—è {}:',
    'no_access': '–£ –≤–∞—Å –Ω–µ–º–∞—î –¥–æ—Å—Ç—É–ø—É –¥–æ —Ä–æ—É—Ç–µ—Ä—ñ–≤.',
    'router_not_found': '–ü–æ–º–∏–ª–∫–∞: –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ç–æ—Ä –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ –∞–±–æ —É –≤–∞—Å –Ω–µ–º–∞—î –¥–æ—Å—Ç—É–ø—É.',
    'password_prompt': '–í–≤–µ–¥—ñ—Ç—å –ø–∞—Ä–æ–ª—å –¥–ª—è –≤–∏–∫–æ–Ω–∞–Ω–Ω—è —Å–∫—Ä–∏–ø—Ç–∞ \'{}\' –Ω–∞ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ç–æ—Ä—ñ {}:',
    'confirmation_prompt': '–í–∏ –¥—ñ–π—Å–Ω–æ —Ö–æ—á–µ—Ç–µ –≤–∏–∫–æ–Ω–∞—Ç–∏ —Å–∫—Ä–∏–ø—Ç \'{}\' –Ω–∞ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ç–æ—Ä—ñ {}?\n\n–í—ñ–¥–ø—Ä–∞–≤—Ç–µ \'—Ç–∞–∫\' –¥–ª—è –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è –∞–±–æ \'–Ω—ñ\' –¥–ª—è —Å–∫–∞—Å—É–≤–∞–Ω–Ω—è.',
    'wrong_password': '–ù–µ–≤—ñ—Ä–Ω–∏–π –ø–∞—Ä–æ–ª—å –¥–ª—è –≤–∏–∫–æ–Ω–∞–Ω–Ω—è —Å–∫—Ä–∏–ø—Ç–∞. –°–ø—Ä–æ–±—É–π—Ç–µ —â–µ —Ä–∞–∑.',
    'script_result': '–†–µ–∑—É–ª—å—Ç–∞—Ç –≤–∏–∫–æ–Ω–∞–Ω–Ω—è —Å–∫—Ä–∏–ø—Ç–∞ \'{}\':\n{}',
    'script_success': '–°–∫—Ä–∏–ø—Ç \'{}\' –≤–∏–∫–æ–Ω–∞–Ω–æ —É—Å–ø—ñ—à–Ω–æ!\n\n–†–µ–∑—É–ª—å—Ç–∞—Ç:\n{}',
    'script_cancelled': '–í–∏–∫–æ–Ω–∞–Ω–Ω—è —Å–∫—Ä–∏–ø—Ç–∞ —Å–∫–∞—Å—É–≤–∞–Ω–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–µ–º.',
    'invalid_response': '–ë—É–¥—å –ª–∞—Å–∫–∞, –≤—ñ–¥–ø–æ–≤—ñ–¥–∞–π—Ç–µ \'—Ç–∞–∫\' –¥–ª—è –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è –∞–±–æ \'–Ω—ñ\' –¥–ª—è —Å–∫–∞—Å—É–≤–∞–Ω–Ω—è.',
    'error_loading_routers': '–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ –¥–∞–Ω–∏—Ö –ø—Ä–æ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ç–æ—Ä–∏.',
    'error_router_not_found': '–ü–æ–º–∏–ª–∫–∞: –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ç–æ—Ä –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ.',
    'access_management': 'üîê –£–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –¥–æ—Å—Ç—É–ø–æ–º –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤:',
    'access_no_permission': '‚ùå –£ –≤–∞—Å –Ω–µ–º–∞—î –ø—Ä–∞–≤ –¥–ª—è —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –¥–æ—Å—Ç—É–ø–æ–º',
    'access_user_added': '‚úÖ –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á {} —É—Å–ø—ñ—à–Ω–æ –¥–æ–¥–∞–Ω–æ –¥–æ —Ä–æ—É—Ç–µ—Ä–∞ \'{}\'',
    'access_user_removed': '‚úÖ –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á {} —É—Å–ø—ñ—à–Ω–æ –≤–∏–¥–∞–ª–µ–Ω–æ –∑ —Ä–æ—É—Ç–µ—Ä–∞ \'{}\'',
    'access_user_exists': '‚ùå –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á {} –≤–∂–µ –º–∞—î –¥–æ—Å—Ç—É–ø –¥–æ —Ä–æ—É—Ç–µ—Ä–∞ \'{}\'',
    'access_user_not_found': '‚ùå –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á {} –Ω–µ –º–∞—î –¥–æ—Å—Ç—É–ø—É –¥–æ —Ä–æ—É—Ç–µ—Ä–∞ \'{}\'',
    'access_router_not_found': '‚ùå –†–æ—É—Ç–µ—Ä \'{}\' –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ',
    'access_select_router': '–í–∏–±–µ—Ä—ñ—Ç—å —Ä–æ—É—Ç–µ—Ä –¥–ª—è {}:',
    'access_enter_user_id': '–í–≤–µ–¥—ñ—Ç—å ID –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –¥–ª—è {} –¥–æ —Ä–æ—É—Ç–µ—Ä–∞ \'{}\':',
    'access_invalid_user_id': '‚ùå –ù–µ–≤—ñ—Ä–Ω–∏–π —Ñ–æ—Ä–º–∞—Ç ID –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞. ID –º–∞—î –±—É—Ç–∏ —á–∏—Å–ª–æ–º –¥–æ–≤–∂–∏–Ω–æ—é 7-10 —Ü–∏—Ñ—Ä.',
    'access_user_list': 'üë• –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ —Ä–æ—É—Ç–µ—Ä–∞ \'{}\':\n{}',
    'access_no_users': ' –£ —Ä–æ—É—Ç–µ—Ä–∞ \'{}\' –Ω–µ–º–∞—î –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤',
    'access_router_info': 'üåê –Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ —Ä–æ—É—Ç–µ—Ä–∏:\n\n{}',
    'access_user_summary': '‚ÑπÔ∏è {}',
    'access_cache_refreshed': '‚úÖ –ö–µ—à —Ä–æ—É—Ç–µ—Ä—ñ–≤ –æ–Ω–æ–≤–ª–µ–Ω–æ',
    'access_stats': 'üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –¥–æ—Å—Ç—É–ø—É:\n\n{}',
    'access_router_management': 'üîê –£–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è —Ä–æ—É—Ç–µ—Ä–æ–º {}:',
    'access_general_info': 'üìã –ó–∞–≥–∞–ª—å–Ω–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ —Å–∏—Å—Ç–µ–º—É:',
    'access_select_router_manage': 'üåê –í–∏–±–µ—Ä—ñ—Ç—å —Ä–æ—É—Ç–µ—Ä –¥–ª—è —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è:'
}

# –ö–æ–Ω—Å—Ç–∞–Ω—Ç–∏ –¥–ª—è —Å—Ç–∞–Ω—ñ–≤ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
USER_STATES = {
    'waiting_for_router': 'waiting_for_router',
    'waiting_for_script': 'waiting_for_script',
    'waiting_for_password': 'waiting_for_password',
    'waiting_for_confirmation': 'waiting_for_confirmation',
    'waiting_for_user_id_add': 'waiting_for_user_id_add',
    'waiting_for_user_id_remove': 'waiting_for_user_id_remove'
}

# –ö–æ–Ω—Å—Ç–∞–Ω—Ç–∏ –¥–ª—è callback_data
CALLBACK_PREFIXES = {
    'router': 'router_',
    'script': 'script_',
    'access': 'access_'
}

# –ö–æ–Ω—Å—Ç–∞–Ω—Ç–∏ –¥–ª—è –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è
CONFIRMATION_ANSWERS = {
    'positive': ['—Ç–∞–∫', 'yes', 'y', '1', 'true'],
    'negative': ['–Ω—ñ', 'no', 'n', '0', 'false']
}

# –ö–æ–Ω—Å—Ç–∞–Ω—Ç–∏ –¥–ª—è –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–∏–≤–Ω–∏—Ö –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å
ADMIN_MESSAGE_TEMPLATE = """üîî –°—Ç–∞—Ç—É—Å –≤–∏–∫–æ–Ω–∞–Ω–Ω—è —Å–∫—Ä–∏–ø—Ç–∞:

üìÖ –ß–∞—Å: {}
üë§ –•—Ç–æ –∑–∞–ø—É—Å—Ç–∏–≤: {}
üåê –ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ç–æ—Ä: {}
üñ• –°–∫—Ä–∏–ø—Ç: {}"""

# –ö–æ–Ω—Å—Ç–∞–Ω—Ç–∏ –¥–ª—è –ª–æ–≥—É–≤–∞–Ω–Ω—è
LOG_MESSAGES = {
    'bot_started': '–ë–æ—Ç –∑–∞–ø—É—â–µ–Ω–æ.',
    'user_started': '–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á {} –ø–æ—á–∞–≤ –≤–∑–∞—î–º–æ–¥—ñ—é –∑ –±–æ—Ç–æ–º.',
    'user_selected_command': '–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á {} –≤–∏–±—Ä–∞–≤ –∫–æ–º–∞–Ω–¥—É /run_script.',
    'routers_loaded': '–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω—ñ —Ä–æ—É—Ç–µ—Ä–∏: {}',
    'user_selected_router': '–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á {} –≤–∏–±—Ä–∞–≤ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ç–æ—Ä: {}',
    'user_no_access': '–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á {} –Ω–µ –º–∞—î –¥–æ—Å—Ç—É–ø—É –¥–æ —Ä–æ—É—Ç–µ—Ä—ñ–≤.',
    'script_executed': '–°–∫—Ä–∏–ø—Ç \'{}\' –±—É–≤ –≤–∏–∫–æ–Ω–∞–Ω–∏–π –Ω–∞ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ç–æ—Ä—ñ \'{}\' –≤ {}.',
    'script_executed_confirmation': '–°–∫—Ä–∏–ø—Ç \'{}\' –±—É–≤ –≤–∏–∫–æ–Ω–∞–Ω–∏–π –Ω–∞ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ç–æ—Ä—ñ \'{}\' –≤ {} (—Ä–µ–∂–∏–º –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è).',
    'wrong_password_attempt': '–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á {} –≤–≤—ñ–≤ –Ω–µ–≤—ñ—Ä–Ω–∏–π –ø–∞—Ä–æ–ª—å –¥–ª—è —Å–∫—Ä–∏–ø—Ç–∞ {}.',
    'script_cancelled_by_user': '–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á {} —Å–∫–∞—Å—É–≤–∞–≤ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è —Å–∫—Ä–∏–ø—Ç–∞ {} –Ω–∞ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ç–æ—Ä—ñ {}',
    'notifications_status': '–ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –¥–ª—è ADMIN_{}: {}',
    'script_mode_status': '–†–µ–∂–∏–º –∑–∞–ø—É—Å–∫—É —Å–∫—Ä–∏–ø—Ç—ñ–≤: {}'
}

# –ö–æ–Ω—Å—Ç–∞–Ω—Ç–∏ –¥–ª—è –¥—ñ–π —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –¥–æ—Å—Ç—É–ø–æ–º
ACCESS_ACTIONS = {
    'add': '–¥–æ–¥–∞–≤–∞–Ω–Ω—è',
    'remove': '–≤–∏–¥–∞–ª–µ–Ω–Ω—è'
}

# –î–æ–ø–æ–º—ñ–∂–Ω—ñ —Ñ—É–Ω–∫—Ü—ñ—ó
def get_user_info(message):
    """–û—Ç—Ä–∏–º—É—î —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –∑ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è"""
    return {
        'id': message.from_user.id,
        'username': message.from_user.username,
        'first_name': message.from_user.first_name,
        'last_name': message.from_user.last_name
    }

def format_admin_message(execution_time, username, router_name, script):
    """–§–æ—Ä–º–∞—Ç—É—î –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –¥–ª—è –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä—ñ–≤"""
    return ADMIN_MESSAGE_TEMPLATE.format(execution_time, username, router_name, script)

def get_current_time():
    """–û—Ç—Ä–∏–º—É—î –ø–æ—Ç–æ—á–Ω–∏–π —á–∞—Å —É —Ñ–æ—Ä–º–∞—Ç—ñ –¥–ª—è –ª–æ–≥—É–≤–∞–Ω–Ω—è"""
    return datetime.now().strftime('%Y-%m-%d %H:%M:%S')

def is_positive_confirmation(text):
    """–ü–µ—Ä–µ–≤—ñ—Ä—è—î, —á–∏ —î –≤—ñ–¥–ø–æ–≤—ñ–¥—å –ø–æ–∑–∏—Ç–∏–≤–Ω–∏–º –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è–º"""
    return text.lower() in CONFIRMATION_ANSWERS['positive']

def is_negative_confirmation(text):
    """–ü–µ—Ä–µ–≤—ñ—Ä—è—î, —á–∏ —î –≤—ñ–¥–ø–æ–≤—ñ–¥—å –Ω–µ–≥–∞—Ç–∏–≤–Ω–∏–º –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è–º"""
    return text.lower() in CONFIRMATION_ANSWERS['negative'] 